{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import axios from'axios';// Create context\nimport{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Check if user is logged in on initial load\nuseEffect(()=>{const checkLoggedIn=async()=>{// Check if token exists in local storage\nconst token=localStorage.getItem('token');if(token){// Set auth token header\nsetAuthToken(token);try{// Verify token by getting user data\nconst res=await axios.get('/users/profile/');setUser(res.data);setIsAuthenticated(true);}catch(err){// Token is invalid\nlocalStorage.removeItem('token');setAuthToken(null);setUser(null);setIsAuthenticated(false);setError('Session expired. Please log in again.');}}setLoading(false);};checkLoggedIn();},[]);// Set auth token for axios\nconst setAuthToken=token=>{if(token){axios.defaults.headers.common['Authorization']=`Bearer ${token}`;}else{delete axios.defaults.headers.common['Authorization'];}};// Register user\nconst register=async userData=>{try{const res=await axios.post('/users/register/',userData);return res.data;}catch(err){var _err$response,_err$response$data;setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||'Registration failed');throw err;}};// Login user\nconst login=async userData=>{try{const res=await axios.post('/token/',userData);// Save token to local storage\nlocalStorage.setItem('token',res.data.access);// Set auth token in headers\nsetAuthToken(res.data.access);// Get user data\nconst userRes=await axios.get('/users/profile/');setUser(userRes.data);setIsAuthenticated(true);setError(null);return res.data;}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||'Login failed');throw err;}};// Logout user\nconst logout=()=>{// Remove token from local storage\nlocalStorage.removeItem('token');// Remove auth token from headers\nsetAuthToken(null);// Reset state\nsetUser(null);setIsAuthenticated(false);};// Update user profile\nconst updateProfile=async userData=>{try{const res=await axios.put('/users/me/',userData);setUser(res.data);return res.data;}catch(err){var _err$response3,_err$response3$data;setError(((_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.detail)||'Profile update failed');throw err;}};// Clear errors\nconst clearError=()=>{setError(null);};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,isAuthenticated,loading,error,register,login,logout,updateProfile,clearError},children:children});};// Export context for use in components\nAuthContext.displayName='AuthContext';AuthProvider.context=AuthContext;export default AuthContext;","map":{"version":3,"names":["React","createContext","useState","useEffect","axios","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","isAuthenticated","setIsAuthenticated","loading","setLoading","error","setError","checkLoggedIn","token","localStorage","getItem","setAuthToken","res","get","data","err","removeItem","defaults","headers","common","register","userData","post","_err$response","_err$response$data","response","detail","login","setItem","access","userRes","_err$response2","_err$response2$data","logout","updateProfile","put","_err$response3","_err$response3$data","clearError","Provider","value","displayName","context"],"sources":["/home/yves/Test/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\nimport axios from 'axios';\n\n// Create context\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Check if user is logged in on initial load\n  useEffect(() => {\n    const checkLoggedIn = async () => {\n      // Check if token exists in local storage\n      const token = localStorage.getItem('token');\n      \n      if (token) {\n        // Set auth token header\n        setAuthToken(token);\n        \n        try {\n          // Verify token by getting user data\n          const res = await axios.get('/users/profile/');\n          setUser(res.data);\n          setIsAuthenticated(true);\n        } catch (err) {\n          // Token is invalid\n          localStorage.removeItem('token');\n          setAuthToken(null);\n          setUser(null);\n          setIsAuthenticated(false);\n          setError('Session expired. Please log in again.');\n        }\n      }\n      \n      setLoading(false);\n    };\n    \n    checkLoggedIn();\n  }, []);\n\n  // Set auth token for axios\n  const setAuthToken = (token) => {\n    if (token) {\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n    } else {\n      delete axios.defaults.headers.common['Authorization'];\n    }\n  };\n\n  // Register user\n  const register = async (userData) => {\n    try {\n      const res = await axios.post('/users/register/', userData);\n      return res.data;\n    } catch (err) {\n      setError(err.response?.data?.detail || 'Registration failed');\n      throw err;\n    }\n  };\n\n  // Login user\n  const login = async (userData) => {\n    try {\n      const res = await axios.post('/token/', userData);\n      \n      // Save token to local storage\n      localStorage.setItem('token', res.data.access);\n      \n      // Set auth token in headers\n      setAuthToken(res.data.access);\n      \n      // Get user data\n      const userRes = await axios.get('/users/profile/');\n      setUser(userRes.data);\n      setIsAuthenticated(true);\n      setError(null);\n      \n      return res.data;\n    } catch (err) {\n      setError(err.response?.data?.detail || 'Login failed');\n      throw err;\n    }\n  };\n\n  // Logout user\n  const logout = () => {\n    // Remove token from local storage\n    localStorage.removeItem('token');\n    \n    // Remove auth token from headers\n    setAuthToken(null);\n    \n    // Reset state\n    setUser(null);\n    setIsAuthenticated(false);\n  };\n\n  // Update user profile\n  const updateProfile = async (userData) => {\n    try {\n      const res = await axios.put('/users/me/', userData);\n      setUser(res.data);\n      return res.data;\n    } catch (err) {\n      setError(err.response?.data?.detail || 'Profile update failed');\n      throw err;\n    }\n  };\n\n  // Clear errors\n  const clearError = () => {\n    setError(null);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        isAuthenticated,\n        loading,\n        error,\n        register,\n        login,\n        logout,\n        updateProfile,\n        clearError\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\n// Export context for use in components\nAuthContext.displayName = 'AuthContext';\nAuthProvider.context = AuthContext;\nexport default AuthContext;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}